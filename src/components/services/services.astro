---
import "./parallax.css";

const servicios = [
  {
    titulo: "Diseño Web",
    categoria: "Interfaz & Estilo",
    descripcion: "Páginas web atractivas y profesionales que representan tu marca.",
    caracteristicas: ["Diseño moderno", "Buen rendimiento", "Fácil de usar"],
    imagen: "/web.svg",
    imagenDark: "/web-sun.svg",
    colorFondo: "#fff8f0",
    colorBorde: "#fbbf24",
    colorTexto: "#92400e",
  },
  {
    titulo: "Sitios Responsive",
    categoria: "Adaptabilidad Web",
    descripcion: "Tu sitio web se ve perfecto en todos los dispositivos y pantallas.",
    caracteristicas: ["Optimizado para celular", "Adaptado a tablet", "Completo en computadora"],
    imagen: "/responsive.svg",
    imagenDark: "/responsive-sun.svg",
    colorFondo: "#eff6ff",
    colorBorde: "#3b82f6",
    colorTexto: "#1e40af",
  },
  {
    titulo: "Carga Rápida",
    categoria: "Optimización Técnica",
    descripcion: "Sitios web optimizados para cargar rápido y mantener a tus visitantes.",
    caracteristicas: ["Optimización de imágenes", "Código limpio", "Hosting rápido"],
    imagen: "/fast.svg",
    imagenDark: "/fast-sun.svg",
    colorFondo: "#fff7ed",
    colorBorde: "#f97316",
    colorTexto: "#c2410c",
  },
  {
    titulo: "SEO",
    categoria: "Posicionamiento Web",
    descripcion: "Configuración SEO para que tu sitio sea encontrado en Google.",
    caracteristicas: ["Metatags precisas", "Previews claras", "Página 404"],
    imagen: "/seo.svg",
    imagenDark: "/seo-sun.svg",
    colorFondo: "#ecfdf5",
    colorBorde: "#10b981",
    colorTexto: "#065f46",
  },
];
---

<section class="parallax-section" id="servicios">
  <div class="parallax-header">
    <h2 class="parallax-title">
      Servicios de <span class="parallax-title-accent">Desarrollo Web</span>
    </h2>
    <p class="parallax-description">
      Todo lo que necesitás para tu presencia online.
    </p>
  </div>

  <div class="parallax-cards-container">
    {servicios.map((servicio, index) => (
      <div 
        class="parallax-card" 
        data-index={index}
        style={`--card-bg:${servicio.colorFondo};--card-border:${servicio.colorBorde};--card-accent:${servicio.colorTexto};`}
      >
        <div class="parallax-card-inner">
          <div class="parallax-card-content">
            <div class="parallax-card-left">
              <img 
                src={servicio.imagen} 
                data-dark-src={servicio.imagenDark}
                alt={servicio.titulo} 
                class="parallax-card-image theme-aware-image" 
              />
              <span class="parallax-category">{servicio.categoria}</span>
              <h3 class="parallax-card-title">{servicio.titulo}</h3>
              <p class="parallax-card-description">{servicio.descripcion}</p>
            </div>

            <div class="parallax-card-right">
              <ul class="parallax-features-list">
                {servicio.caracteristicas.map((caracteristica, i) => (
                  <li class="parallax-feature-item" data-delay={i}>
                    <span class="parallax-feature-number">{i + 1}</span>
                    {caracteristica}
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll<HTMLImageElement>('.theme-aware-image');
    const root = document.documentElement;

    // Función para actualizar imágenes según tema
    const updateImages = () => {
      const isDark = root.getAttribute('data-theme') === 'dark';
      images.forEach(img => {
        if (isDark && img.dataset.darkSrc) {
          img.src = img.dataset.darkSrc;
        } else if (!isDark && img.dataset.src) {
          img.src = img.dataset.src;
        } else if (!isDark) {
          // Guardar src original si no existe dataset.src
          if (!img.dataset.src) {
            img.dataset.src = img.src;
          }
          img.src = img.dataset.src;
        }
      });
    };

    // Guardar src original al cargar
    images.forEach(img => {
      if (!img.dataset.src) {
        img.dataset.src = img.src;
      }
    });

    // Actualizar al cargar
    updateImages();

    // Observar cambios en data-theme
    const observer = new MutationObserver(updateImages);
    observer.observe(root, {
      attributes: true,
      attributeFilter: ['data-theme']
    });

    // === ANIMACIONES DE SCROLL (tu código original) ===
    const cards = document.querySelectorAll('.parallax-card');
    const cardObserver = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            const items = entry.target.querySelectorAll('.parallax-feature-item');
            items.forEach((item, i) => {
              setTimeout(() => item.classList.add('is-visible'), i * 100);
            });
          }
        });
      },
      { threshold: 0.2, rootMargin: '0px 0px -100px 0px' }
    );
    cards.forEach(card => cardObserver.observe(card));
  });
</script>